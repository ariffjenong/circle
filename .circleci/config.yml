version: 2.1

jobs:
  timeout: 240m
  compile:
   docker:
    - image: arifjenong/rom:cirrus
      auth:
   resource_class: large
   steps: 
      - run:
          context: rclone_config
          command: |
           cd ~ && rm -rf lineage-19.1 && rm -rf znxt
           mkdir -p ~/lineage-19.1
           mkdir -p ~/znxt
           mkdir -p ~/.config/rclone
           echo $rclone_config > ~/.config/rclone/rclone.conf
           rclone copy znxtproject:ccache/lineage-19.1/ccache.tar.gz ~/znxt -P
           cd ~/znxt
           time tar xf ccache.tar.gz
           rm ccache.tar.gz
           #time rclone copy znxtproject:ccache/lineage-19.1/out.tar.gz ~/lineage-19.1 -P
           #cd ~/lineage-19.1
           #time tar xf out.tar.gz
           #rm -rf out.tar.gz
           #sleep 13m
           #cd ~/lineage-19.1
           #ls -lh
           cd ~/lineage-19.1
           repo init --depth=1 --no-repo-verify -u https://github.com/ariffjenong/android.git -b lineage-19.1 -g default,-mips,-darwin,-notdefault
           git clone https://github.com/ariffjenong/local_manifest.git --depth=1 -b LOS19 .repo/local_manifests
           repo sync -c --no-clone-bundle --no-tags --optimized-fetch --prune --force-sync -j12 || repo sync -c --no-clone-bundle --no-tags --optimized-fetch --prune --force-sync -j8
           #bash build.sh
           cd ~/lineage-19.1/out/target/product/maple_dsds
           ls -lh
           rclone copy $(ls *maple*UNOFFICIAL*.zip) znxtproject:rom/lineage-19.1 -P && rclone copy $(ls *.md5sum) znxtproject:rom/lineage-19.1 -P && ls -lh
           #bash build_zip.sh
           #bash sf.sh
           cd ~ && rm -rf lineage-19.1 && rm -rf znxt
           
workflows:
  version: 2.1
  cooking:
    jobs:
      - compile